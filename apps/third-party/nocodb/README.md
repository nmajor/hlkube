# NocoDB

NocoDB is an open-source no-code database platform that transforms any database into a smart-spreadsheet interface.

## Components

- **PostgreSQL Cluster**: A 2-instance PostgreSQL cluster with single-replica Longhorn storage
- **Connection Pooler**: PgBouncer connection pooler for optimized database connections
- **NocoDB Application**: The main NocoDB container with persistent data storage
- **OAuth2 Authentication**: Protected by oauth2-proxy for secure access

## Configuration

### Database

- PostgreSQL cluster with 2 instances for high availability
- 5GB storage using Longhorn single-replica storage class
- Connection pooling with PgBouncer for optimal performance
- Monitoring enabled for Prometheus integration

### Application

- Single replica deployment with resource limits
- Persistent storage for application data (2GB)
- Health checks configured for reliability
- Environment variables for database connection and admin setup
- Email/password authentication disabled (relies on oauth2-proxy)

### Security

- All sensitive data stored in sealed secrets
- OAuth2 authentication required for access (NocoDB's built-in auth disabled)
- No admin credentials needed since authentication handled by oauth2-proxy

## Access

The application is available at: https://nocodb.nmajor.net

Authentication is handled by oauth2-proxy, requiring GitHub authentication.

## Sealed Secrets

Before deploying, you need to:

1. **Update the secret files** with your actual values:

   - `postgres-credentials.secret` - Set your PostgreSQL password
   - `nocodb-secrets.secret` - Set your JWT secret (admin credentials not needed since authentication is disabled)

2. **Run the sealing script** from the repository root:

   ```bash
   ./seal-secrets.sh
   ```

3. **Commit the sealed files**:
   ```bash
   git add *.sealed.yaml
   git commit -m "Update NocoDB sealed secrets"
   ```

### Secret Files Structure

- `postgres-credentials.secret` - PostgreSQL database credentials
- `nocodb-secrets.secret` - NocoDB application secrets (JWT secret only)

**Important**: The `.secret` files contain sensitive data and should never be committed to git. Only the `.sealed.yaml` files generated by the sealing script should be committed.

## Monitoring

The PostgreSQL cluster and connection pooler have monitoring enabled for Prometheus integration. Metrics are available through Grafana at: https://grafana.nmajor.net
